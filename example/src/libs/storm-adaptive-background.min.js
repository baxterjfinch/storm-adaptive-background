!function(t,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?module.exports=n():t.AdaptiveBackground=n()}(this,function(){"use strict";function t(t,s){var a=[].slice.call(document.querySelector(t));if(0===a.length)throw new Error("Adaptive background requires both source element and target");return a.forEach(function(t,a){n[a]=e(Object.create(i),{DOMElement:t,settings:o({},r,s)}),n[a].init()}),n}!function(t){var n=function(){return document.createElement("canvas").getContext("2d")},e=function(t,e){var o=new Image,r=t.src||t;"data:"!==r.substring(0,5)&&(o.crossOrigin="Anonymous"),o.onload=function(){var t=n("2d");t.drawImage(o,0,0);var r=t.getImageData(0,0,o.width,o.height);e&&e(r.data)},o.src=r},o=function(t){return["rgb(",t,")"].join("")},r=function(t){return t.map(function(t){return o(t.name)})},i=5,s=10,a={};a.colors=function(t,n){n=n||{};var a=n.exclude||[],c=n.paletteSize||s;e(t,function(e){for(var s=t.width*t.height||e.length,u={},l="",d=[],g={dominant:{name:"",count:0},palette:Array.apply(null,new Array(c)).map(Boolean).map(function(){return{name:"0,0,0",count:0}})},h=0;s>h;){if(d[0]=e[h],d[1]=e[h+1],d[2]=e[h+2],l=d.join(","),u[l]=l in u?u[l]+1:1,-1===a.indexOf(o(l))){var m=u[l];m>g.dominant.count?(g.dominant.name=l,g.dominant.count=m):g.palette.some(function(t){return m>t.count?(t.name=l,t.count=m,!0):void 0})}h+=4*i}if(n.success){var f=r(g.palette);n.success({dominant:o(g.dominant.name),secondary:f[0],palette:f})}})},t.RGBaster=t.RGBaster||a}(window);var n=[],e=require("object-assign"),o=require("merge"),r={target:null,exclude:["rgb(0,0,0)","rgba(255,255,255)"],cssBackground:!1,normaliseTextColour:!0,normalisedTextColours:{light:"#fff",dark:"#000"},lumaClasses:{light:"ab-light",dark:"ab-dark"},callback:null},i={init:function(){this.targets=[].slice.call(document.querySelectorAll(this.settings.target)),this.source=this.settings.cssBackground?this.getCSSBackground():this.DOMElement,this.findColour()},applyContrast:function(){var t=function(t){var n=t.match(/\d+/g);return(299*n[0]+587*n[1]+114*n[2])/1e3},n=t(this.colours.dominant)>=128?this.settings.normalisedTextColours.dark:this.settings.normalisedTextColours.light,e=t(this.colours.dominant)<=128?this.settings.lumaClasses.dark:this.settings.lumaClasses.light;this.targets.forEach(function(t){this.settings.normaliseTextColour&&(t.style.color=n),t.className=t.className+" "+e}.bind(this))},applyColour:function(){return this.targets.forEach(function(t){t.style.backgroundColor=this.colours.dominant}.bind(this)),this},findColour:function(){RGBaster.colors(this.source,{paletteSize:20,exclude:this.settings.exclude,success:function(t){this.colours=t,this.applyColour().applyContrast()}.bind(this)})},getCSSBackground:function(){var t=this.DOMElement.css("background-image"),n=/\(([^)]+)\)/;return n.exec(t)[1].replace(/"/g,"")}};return{init:t}});